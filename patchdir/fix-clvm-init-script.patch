Index: new/debian/clvm.init
===================================================================
--- new.orig/debian/clvm.init	2011-11-25 08:39:04.000000000 +0100
+++ new/debian/clvm.init	2011-11-25 08:42:54.000000000 +0100
@@ -4,8 +4,8 @@
 # Provides:          clvm
 # Required-Start:    $remote_fs lvm2 cman
 # Required-Stop:     $remote_fs lvm2 cman
-# Default-Start:     S
-# Default-Stop:      0 6
+# Default-Start:     2 3 4 5
+# Default-Stop:      0 1 6
 # Short-Description: start and stop the lvm cluster locking daemon
 ### END INIT INFO
 #
@@ -26,28 +26,31 @@
 . /lib/lsb/init-functions
 
 if [ ! -f /etc/cluster/cluster.conf ]; then
-	log_failure_msg "clvmd: cluster not configured. Aborting."
+        log_action_msg "clvmd: cluster not configured"
 	exit 0
 fi
 
-if ! cman_tool status >/dev/null 2>&1; then
-	log_failure_msg "clvmd: cluster is not running. Aborting."
-	exit 0
-fi
-
-CLVMDTIMEOUT=20
+CLVMDTIMEOUT=30
+START_CLVM=no
 
 # Read configuration variable file if it is present
 [ -r /etc/default/$NAME ] && . /etc/default/$NAME
 
+[ "$START_CLVM" = "yes" ] || exit 0
+
 DAEMON_OPTS="-T$CLVMDTIMEOUT"
 
+if ! cman_tool status >/dev/null 2>&1; then
+	log_failure_msg "clvmd: cluster is not running. Aborting."
+	exit 1
+fi
+
 do_start()
 {
-	start-stop-daemon --start --quiet --exec $DAEMON -- $DAEMON_OPTS || status="$?"
+	start-stop-daemon --start --quiet --exec $DAEMON -- $DAEMON_OPTS || return $?
 	# flush cache
 	vgscan > /dev/null 2>&1 
-	return $status
+	return 0
 }
 
 do_activate()
@@ -55,9 +58,6 @@
 	if [ -n "$LVM_VGS" ] ; then
 		log_action_msg  "Activating VGs $LVM_VGS"
 		vgchange -ayl $LVM_VGS || return $?
-	else
-		log_action_msg  "Activating all VGs"
-		vgchange -ayl || return $?
 	fi
 }
 
@@ -91,7 +91,7 @@
 		case "$status" in
 			0) log_end_msg 0 ;;
 			1) log_action_msg " already running" ; log_end_msg 0 ;;
-			*) log_end_msg 1 ;;
+			*) log_end_msg 1 ; exit $status ;;
 		esac
 		# and activate clustered volume groups
 		do_activate
@@ -99,6 +99,10 @@
 		exit $status
 	;;
 	stop)
+		pid=$( pidof $DAEMON )
+		if [ -z "$pid" ] ; then
+			exit 0
+		fi
 		# deactivate volumes...
 		log_daemon_msg "Deactivating VG $vg:"
 		do_deactivate
Index: new/debian/rules
===================================================================
--- new.orig/debian/rules	2011-11-25 08:39:04.000000000 +0100
+++ new/debian/rules	2011-11-25 08:39:39.000000000 +0100
@@ -160,7 +160,7 @@
 install_clvm: DIR = $(BUILD_DIR)/install_deb
 install_clvm: $(STAMPS_DIR)/install_deb
 	+$(MAKE_SELF) install-base-prep INSTALL_DIR='$(DIR)'
-	dh_installinit --no-start -- start 63 S . start 51 0 6 .
+	dh_installinit --no-start -- start 63 2 3 4 5 . start 51 0 1 6 .
 	+$(MAKE_SELF) install-base
 
 install_dmsetup: export DH_OPTIONS = -pdmsetup
Index: new/debian/clvm.default
===================================================================
--- new.orig/debian/clvm.default	2011-11-25 08:39:04.000000000 +0100
+++ new/debian/clvm.default	2011-11-25 08:42:26.000000000 +0100
@@ -1,8 +1,11 @@
 # Bourne shell compatible script, sourced by /etc/init.d/clvm to set
 # additional arguments for clvmd.
 
+# enable clmvd
+#START_CLVM=yes
+
 # Startup timeout: 
-CLVMDTIMEOUT=20
+#CLVMDTIMEOUT=30
 
 # Volume groups to activate on startup:
 # LVM_VGS="cluster_vg1 cluster_vg2"
